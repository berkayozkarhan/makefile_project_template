# CONSTANTS
PROJECT_ROOT_DIR = $(shell dirname "$(CURRENT_DIR)")
PROJECT_SRC_DIR = $(PROJECT_ROOT_DIR)/src
MODULE1_DIR = $(PROJECT_SRC_DIR)/module_1
MODULE2_DIR = $(PROJECT_SRC_DIR)/module_2
MODULE3_DIR = $(PROJECT_SRC_DIR)/module_3

MODULE1_INCLUDE_DIR =$(MODULE1_DIR)/include
MODULE2_INCLUDE_DIR =$(MODULE2_DIR)/include
MODULE3_INCLUDE_DIR =$(MODULE3_DIR)/include


PROJECT_BUILD_DIR = $(PROJECT_ROOT_DIR)/build
PROJECT_BIN_DIR = $(PROJECT_BUILD_DIR)/bin
PROJECT_LIB_DIR = $(PROJECT_BUILD_DIR)/lib
PROJECT_DYNAMIC_LIB_DIR = $(PROJECT_LIB_DIR)/dynamic
PROJECT_STATIC_LIB_DIR = $(PROJECT_LIB_DIR)/static



MODULE1_LIB = $(PROJECT_DYNAMIC_LIB_DIR)/libmodule1.so
MODULE2_LIB = $(PROJECT_DYNAMIC_LIB_DIR)/libmodule2.so
MODULE3_LIB = $(PROJECT_DYNAMIC_LIB_DIR)/libmodule3.so

MODULE_NAME = app

# DIRECTORIES TO CREATE
BUILD_APP_DIR = $(PROJECT_BUILD_DIR)/$(MODULE_NAME)
BUILD_OBJ_DIR = $(BUILD_APP_DIR)/obj

CURRENT_DIR = $(shell pwd)
MODULE_SRC_DIR = $(CURRENT_DIR)/main
SRC1 = $(MODULE_SRC_DIR)/main.c
OBJ1 = $(BUILD_OBJ_DIR)/$(MODULE_NAME).o

# COMPILER VARS
CC = /usr/bin/gcc
INCLUDE_FLAGS = -I$(MODULE1_INCLUDE_DIR) \
				 -I$(MODULE2_INCLUDE_DIR) \
				  -I$(MODULE3_INCLUDE_DIR)
CFLAGS = -Wall -Werror


TARGET_NAME = main
TARGET = $(PROJECT_BIN_DIR)/$(TARGET_NAME)

all: prepare $(TARGET)

prepare:
	mkdir -p $(BUILD_APP_DIR) \
			 $(BUILD_OBJ_DIR)

$(TARGET): $(OBJ1)
	$(CC) $< $(MODULE1_LIB) $(MODULE2_LIB) $(MODULE3_LIB) -o $@

$(OBJ1): $(SRC1)
	$(CC) -c $< $(INCLUDE_FLAGS) -o $@






check_vars:
	echo PROJECT_ROOT_DIR: $(PROJECT_ROOT_DIR)
	echo PROJECT_BUILD_DIR: $(PROJECT_BUILD_DIR)
	echo PROJECT_BIN_DIR: $(PROJECT_BIN_DIR)
	echo PROJECT_LIB_DIR: $(PROJECT_LIB_DIR)
	echo PROJECT_DYNAMIC_LIB_DIR: $(PROJECT_DYNAMIC_LIB_DIR)
	echo PROJECT_STATIC_LIB_DIR: $(PROJECT_STATIC_LIB_DIR)
	echo MODULE_NAME: $(MODULE_NAME)
	echo BUILD_APP_DIR: $(BUILD_APP_DIR)
	echo BUILD_OBJ_DIR: $(BUILD_OBJ_DIR)


clean:
	-rm -rf $(BUILD_APP_DIR) \
			$(BUILD_OBJ_DIR) \
			$(TARGET)



.DEFAULT_GOAL = all
