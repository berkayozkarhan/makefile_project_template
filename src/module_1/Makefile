# CONSTANT
PROJECT_ROOT_DIR = ../..
PROJECT_BUILD_DIR = $(PROJECT_ROOT_DIR)/build
PROJECT_MODULE_DIR = $(PROJECT_BUILD_DIR)/modules
PROJECT_LIB_DIR = $(PROJECT_BUILD_DIR)/lib
PROJECT_DYNAMIC_LIB_DIR = $(PROJECT_LIB_DIR)/dynamic

CURRENT_DIRECTORY = $(shell pwd)
MODULE_SRC_DIRECTORY = $(CURRENT_DIRECTORY)/src
MODULE_INCLUDE_DIRECTORY = $(CURRENT_DIRECTORY)/include

MODULE_NAME = module1

# TO CREATE
OBJ_DIR = $(PROJECT_MODULE_DIR)/$(MODULE_NAME)/obj
SRC_1 = $(MODULE_SRC_DIRECTORY)/$(MODULE_NAME).c
OBJ_1 = $(OBJ_DIR)/$(MODULE_NAME).o

TARGET = $(PROJECT_DYNAMIC_LIB_DIR)/lib$(MODULE_NAME).so

# COMPILER VARIABLES
INCLUDE_FLAGS = -I$(MODULE_INCLUDE_DIRECTORY)
CFLAGS = -Wall -Werror
SHARED_LIB_FLAGS = --shared -fPIC
CC = /usr/bin/gcc

all: prepare $(TARGET)

prepare:
	mkdir -p $(OBJ_DIR)

$(TARGET): $(OBJ_1)
	$(CC) $(SHARED_LIB_FLAGS) $< -o $@

$(OBJ_1): $(SRC_1)
	$(CC) $(CFLAGS) $(INCLUDE_FLAGS) -c $< -o $@

check_vars:
	echo ##### CONSTANTS #####

	echo PROJECT_ROOT_DIR: $(PROJECT_ROOT_DIR)
	echo PROJECT_BUILD_DIR: $(PROJECT_BUILD_DIR)
	echo PROJECT_MODULE_DIR: $(PROJECT_MODULE_DIR)
	echo PROJECT_LIB_DIR: $(PROJECT_LIB_DIR)
	echo PROJECT_DYNAMIC_LIB_DIR: $(PROJECT_DYNAMIC_LIB_DIR)
	
	echo ##### CONSTANTS #####

	echo ##### DIRECTORIES #####

	echo CURRENT_DIRECTORY: $(CURRENT_DIRECTORY)
	echo MODULE_SRC_DIRECTORY: $(MODULE_SRC_DIRECTORY)
	echo MODULE_INCLUDE_DIRECTORY: $(MODULE_INCLUDE_DIRECTORY)
	
	echo ##### DIRECTORIES #####
	
	echo MODULE_NAME: $(MODULE_NAME)

	echo ##### PROPERTIES - TARGETS - TO CREATE #####
	echo OBJ_DIR: $(OBJ_DIR)
	echo SRC_1: $(SRC_1)
	echo OBJ_1: $(OBJ_1)
	echo ##### PROPERTIES - TARGETS - TO CREATE #####
	
	echo TARGET: $(TARGET)

	echo ##### COMPILER FLAGS #####
	echo INCLUDE_FLAGS: $(INCLUDE_FLAGS)
	echo CFLAGS: $(CFLAGS)
	echo SHARED_LIB_FLAGS: $(SHARED_LIB_FLAGS)
	echo CC: $(CC)
	echo ##### COMPILER FLAGS #####

clean:
	-rm -rf $(OBJ_DIR) \
			$(OBJ_1) \
			$(TARGET)

.DEFAULT_GOAL = all